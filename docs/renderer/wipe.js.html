<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: wipe.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: wipe.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const $ = require('jquery');
const { ipcRenderer } = require('electron');
const {
    GetPorts
} = require('../../helpers/serial');
const { Brocade } = require('../../models/switches/Brocade');

let interval;
let sw;

/**
 * Populate the ports list when it is sent back by the main process
 */
ipcRenderer.on("serial:getports:reply", (event, portsList) => {
    let ports = [];
    portsList.forEach(port => {
        let html = `
            &lt;option value=${port.comName}>${port.comName}&lt;/option>
        `;
        ports.push(html);
    })

    ports.join('');
    $("#ports-list").html(ports);
})

// Ask the main process for a list of active serial ports
const GetPortsList = () => ipcRenderer.send("serial:getports");

/**
 * When the switch outputs some data, log it to the in-window console
 * @param {string} data - The data to be logged
 */
const LoggerCallback = (data) => {
    let output = document.createElement('div');
    output.className = 'console-text';
    output.innerText = data;

    let cons = document.getElementById('console-output');
    cons.appendChild(output);

    cons.scrollTo(0, cons.scrollHeight);
}

/**
 * Reset the status and wipe buttons for the user
 */
const ResetWipe = () => {
    $("#status").text("Hit wipe and then plug in the switch");
    $("#wipe-btn").attr("disabled", false);
}

/**
 * Handle updating the GUI when the user presses the connect / disconnect button
 * as well as handle the global switch interaction object
 */
$("#connect-btn").click(e => {
    if (!sw) {
        let port = $("#ports-list").val();
        sw = new Brocade(port, 9600, "NULL", LoggerCallback);
        $("#connect-btn").text("Disconnect");
        $("#ports-list").attr('disabled', true);
        ResetWipe();
    } else {
        sw.disconnect();
        sw = null;
        $("#connect-btn").text("Connect");
        $("#status").text("Connect to a Port");
        $("#ports-list").attr('disabled', false);
        $("#wipe-btn").attr("disabled", true);
    }
})

/**
 * When the user clicks the wipe button, handle wiping the switch 
 * so long as one is connected
 */
$("#wipe-btn").click(e => {
    if (sw) {
        $("#status").text("Wiping...");
        $("#wipe-btn").attr('disabled', true);
        $("#console-output").text('');
        sw.wipe().then(() => ResetWipe());
    }
})

/**
 * Update the list of active serial connections every 5 seconds.
 */
$(document).ready(e => {
    GetPortsList();
    interval = window.setInterval(() => {
        GetPortsList();
    }, 5000)
})</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ICX6450.html">ICX6450</a></li><li><a href="SwitchModule.html">SwitchModule</a></li><li><a href="SwitchPort.html">SwitchPort</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BeginConfiguration">BeginConfiguration</a></li><li><a href="global.html#GetContent">GetContent</a></li><li><a href="global.html#GetKey">GetKey</a></li><li><a href="global.html#GetPortsList">GetPortsList</a></li><li><a href="global.html#LoadSettings">LoadSettings</a></li><li><a href="global.html#LoggerCallback">LoggerCallback</a></li><li><a href="global.html#NextPage">NextPage</a></li><li><a href="global.html#ProgressBar">ProgressBar</a></li><li><a href="global.html#ResetWipe">ResetWipe</a></li><li><a href="global.html#SaveSettings">SaveSettings</a></li><li><a href="global.html#SetContent">SetContent</a></li><li><a href="global.html#SetDotSize">SetDotSize</a></li><li><a href="global.html#SetSetting">SetSetting</a></li><li><a href="global.html#StackFail">StackFail</a></li><li><a href="global.html#TryConnect">TryConnect</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jul 10 2018 12:15:28 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
